# Description
This directory archives the pipeline we used to run Clair3 and benchmark.


# Execution environments
1. Minimap2
```bash
conda env create -f ./envs/minimap2.yaml;
```
2. Clair3
prepare clair3 environment (docker image, for example) and run the image following https://github.com/HKU-BAL/Clair3?tab=readme-ov-file#option-2-singularity
make sure you have already installed docker or singularity, and download the image
```bash
conda config --add channels defaults
conda create -n singularity-env -c conda-forge singularity -y
conda activate singularity-env

# singularity pull docker pre-built image
singularity pull docker://hkubal/clair3:v1.0.4

```
you also need to download several models manually because not all models were contained in the latest package(see https://github.com/HKU-BAL/Clair3?tab=readme-ov-file#ont-provided-models) or you can use the image we prepared at ../image/clair3.sif

3. hap.py
```bash
conda env create -f ./envs/hap.yaml;
```


# Pipelines
1. Prepare reference
```
bash ./prepare/prepare.sh
```

2. run alignment
```
bash ./alignment/alignment.sh
```

3. run Clair3
```
bash ./variant_calling/clair3.sh
```

4. run hap.py
```
bash ./benchmark/benchmark.sh
```


# Results descriptions
For each directory in `../results/alignment`, sequences were aligned to hg38.

For each directory in `../results/variant_calling`, variants were called by clair3 with different model pre-trained for different basecalling configuration.

For each directory in `../results/benchmark`, benchmark results were generated by hap.py, you can check `*.summary.csv` files to see F1 scores.



# Repeat our results
To repeat our results, please 
1. Install the forementioned conda environment.

2. Run `run_all.sh`
```
bash ./run_all.sh;
```

